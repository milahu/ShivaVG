#include "test.h"
#include <ctype.h>
#include <math.h>

VGuint fillColor = 0xFF0000FF; // red

// example path
const VGubyte commands[] = {
   VG_MOVE_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_LINE_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS,
   VG_CUBIC_TO_ABS, VG_LINE_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS, VG_LINE_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS,
   VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_CUBIC_TO_ABS, VG_LINE_TO_ABS,
   VG_CLOSE_PATH
};

const VGfloat data[] = {
   -129.830002f, 103.065002f, -129.326996f, 109.112999f, -128.339005f,
   115.681999f, -126.599998f, 118.801003f, -126.599998f, 118.801003f,
   -130.199997f, 131.201004f, -121.400002f, 144.401001f, -121.400002f,
   144.401001f, -121.800003f, 151.600998f, -120.199997f, 154.800995f,
   -120.199997f, 154.800995f, -116.199997f, 163.201004f, -111.400002f,
   164.001007f, -107.515999f, 164.647995f, -98.792999f, 167.716995f,
   -88.931999f, 169.121002f, -88.931999f, 169.121002f, -71.800003f,
   183.201004f, -75.000000f, 196.001007f, -75.000000f, 196.001007f,
   -75.400002f, 212.401001f, -79.000000f, 214.001007f, -79.000000f,
   214.001007f, -67.400002f, 202.800995f, -77.000000f, 219.600998f,
   -81.400002f, 238.401001f, -81.400002f, 238.401001f, -55.799999f,
   216.800995f, -71.400002f, 235.201004f, -81.400002f, 261.200989f,
   -81.400002f, 261.200989f, -61.799999f, 242.800995f, -69.000000f,
   251.201004f, -72.199997f, 260.001007f, -72.199997f, 260.001007f,
   -29.000000f, 232.800995f, -59.799999f, 262.401001f, -59.799999f,
   262.401001f, -51.799999f, 258.800995f, -47.400002f, 261.601013f,
   -47.400002f, 261.601013f, -40.599998f, 260.401001f, -41.400002f,
   262.001007f, -41.400002f, 262.001007f, -62.200001f, 272.401001f,
   -65.800003f, 290.800995f, -65.800003f, 290.800995f, -57.400002f,
   280.800995f, -60.599998f, 291.601013f, -60.200001f, 303.200989f,
   -60.200001f, 303.200989f, -56.200001f, 281.601013f, -56.599998f,
   319.200989f, -56.599998f, 319.200989f, -37.400002f, 301.200989f,
   -49.000000f, 322.001007f, -49.000000f, 338.800995f, -49.000000f,
   338.800995f, -33.799999f, 322.401001f, -40.200001f, 335.200989f,
   -40.200001f, 335.200989f, -30.200001f, 326.401001f, -34.200001f,
   341.601013f, -34.200001f, 341.601013f, -35.000000f, 352.001007f,
   -30.600000f, 340.800995f, -30.600000f, 340.800995f, -14.600000f,
   310.200989f, -20.600000f, 336.401001f, -20.600000f, 336.401001f,
   -21.400000f, 355.601013f, -16.600000f, 340.800995f, -16.600000f,
   340.800995f, -16.200001f, 351.200989f, -7.000000f, 358.401001f,
   -7.000000f, 358.401001f, -8.200000f, 307.601013f, 4.600000f,
   343.601013f, 8.600000f, 360.001007f, 8.600000f, 360.001007f, 11.400000f,
   350.800995f, 11.000000f, 345.601013f, 11.000000f, 345.601013f,
   25.799999f, 329.200989f, 19.000000f, 353.601013f, 19.000000f,
   353.601013f, 34.200001f, 330.800995f, 31.000000f, 344.001007f,
   31.000000f, 344.001007f, 23.400000f, 360.001007f, 25.000000f,
   364.800995f, 25.000000f, 364.800995f, 41.799999f, 330.001007f,
   43.000000f, 328.401001f, 43.000000f, 328.401001f, 41.000000f,
   370.802002f, 51.799999f, 334.800995f, 51.799999f, 334.800995f,
   57.400002f, 346.800995f, 54.599998f, 351.200989f, 54.599998f,
   351.200989f, 62.599998f, 343.200989f, 61.799999f, 340.001007f,
   61.799999f, 340.001007f, 66.400002f, 331.800995f, 69.199997f,
   345.401001f, 69.199997f, 345.401001f, 71.000000f, 354.800995f,
   72.599998f, 351.601013f, 72.599998f, 351.601013f, 76.599998f,
   375.601990f, 77.800003f, 352.800995f, 77.800003f, 352.800995f,
   79.400002f, 339.200989f, 72.199997f, 327.601013f, 72.199997f,
   327.601013f, 73.000000f, 324.401001f, 70.199997f, 320.401001f,
   70.199997f, 320.401001f, 83.800003f, 342.001007f, 76.599998f,
   313.200989f, 76.599998f, 313.200989f, 87.801003f, 321.200989f,
   89.000999f, 321.200989f, 89.000999f, 321.200989f, 75.400002f,
   298.001007f, 84.199997f, 302.800995f, 84.199997f, 302.800995f,
   79.000000f, 292.401001f, 97.000999f, 304.401001f, 97.000999f,
   304.401001f, 81.000000f, 288.401001f, 98.600998f, 298.001007f,
   98.600998f, 298.001007f, 106.600998f, 304.401001f, 99.000999f,
   294.401001f, 99.000999f, 294.401001f, 84.599998f, 278.401001f,
   106.600998f, 296.401001f, 106.600998f, 296.401001f, 118.200996f,
   312.800995f, 119.000999f, 315.601013f, 119.000999f, 315.601013f,
   109.000999f, 286.401001f, 104.600998f, 283.601013f, 104.600998f,
   283.601013f, 113.000999f, 247.201004f, 154.201004f, 262.800995f,
   154.201004f, 262.800995f, 161.001007f, 280.001007f, 165.401001f,
   261.601013f, 165.401001f, 261.601013f, 178.201004f, 255.201004f,
   189.401001f, 282.800995f, 189.401001f, 282.800995f, 193.401001f,
   269.200989f, 192.600998f, 266.401001f, 192.600998f, 266.401001f,
   199.401001f, 267.601013f, 198.600998f, 266.401001f, 198.600998f,
   266.401001f, 211.800995f, 270.800995f, 213.001007f, 270.001007f,
   213.001007f, 270.001007f, 219.800995f, 276.800995f, 220.201004f,
   273.200989f, 220.201004f, 273.200989f, 229.401001f, 276.001007f,
   227.401001f, 272.401001f, 227.401001f, 272.401001f, 236.201004f,
   288.001007f, 236.600998f, 291.601013f, 239.001007f, 277.601013f,
   241.001007f, 280.401001f, 241.001007f, 280.401001f, 242.600998f,
   272.800995f, 241.800995f, 271.601013f, 241.001007f, 270.401001f,
   261.800995f, 278.401001f, 266.601013f, 299.200989f, 268.601013f,
   307.601013f, 268.601013f, 307.601013f, 274.601013f, 292.800995f,
   273.001007f, 288.800995f, 273.001007f, 288.800995f, 278.200989f,
   289.601013f, 278.601013f, 294.001007f, 278.601013f, 294.001007f,
   282.601013f, 270.800995f, 277.800995f, 264.800995f, 277.800995f,
   264.800995f, 282.200989f, 264.001007f, 283.401001f, 267.601013f,
   283.401001f, 260.401001f, 283.401001f, 260.401001f, 290.601013f,
   261.200989f, 290.601013f, 258.800995f, 290.601013f, 258.800995f,
   295.001007f, 254.800995f, 297.001007f, 259.601013f, 297.001007f,
   259.601013f, 284.601013f, 224.401001f, 303.001007f, 243.600998f,
   303.001007f, 243.600998f, 310.200989f, 254.401001f, 306.601013f,
   235.600998f, 303.001007f, 216.800995f, 299.001007f, 215.201004f,
   303.800995f, 214.800995f, 303.800995f, 214.800995f, 304.601013f,
   211.201004f, 302.601013f, 209.600998f, 300.601013f, 208.001007f,
   303.800995f, 209.600998f, 303.800995f, 209.600998f, 303.800995f,
   209.600998f, 308.601013f, 213.600998f, 303.401001f, 191.600998f,
   303.401001f, 191.600998f, 309.800995f, 193.201004f, 297.800995f,
   164.001007f, 297.800995f, 164.001007f, 300.601013f, 161.600998f,
   296.601013f, 153.201004f, 296.601013f, 153.201004f, 304.601013f,
   157.600998f, 307.401001f, 156.001007f, 307.401001f, 156.001007f,
   307.001007f, 154.401001f, 303.800995f, 150.401001f, 303.800995f,
   150.401001f, 282.200989f, 95.599998f, 302.601013f, 117.600998f,
   302.601013f, 117.600998f, 314.450989f, 131.151001f, 308.050995f,
   108.350998f, 308.050995f, 108.350998f, 298.940002f, 84.341003f,
   299.717010f, 80.044998f, -129.830002f, 103.065002f
};

VGPaint paint;
VGPath path;

void loadPath(void)
{
   VGfloat clearColor[4] = {1.0f, 1.0f, 1.0f, 1.0f};


   /*
    * VGubyte pathSegments[5] = {
    *    VG_MOVE_TO_ABS,
    *    VG_LINE_TO_ABS,
    *    VG_LINE_TO_ABS,
    *    VG_LINE_TO_ABS,
    *    VG_CLOSE_PATH
    * };
    * 
    * VGfloat points[4*2] = {
    *    0.25f, 0.5f,
    *    0.75f, 0.5f,
    *    0.35f, 1.0f,
    *    0.5f, 0.75f
    * };
    */

   VGubyte pathSegments[5] = {
      VG_MOVE_TO,
      VG_LINE_TO,
      VG_LINE_TO,
      VG_LINE_TO,
      VG_CLOSE_PATH
   };

   VGfloat points[4*2] = {
      0.2f, 0.2f,
      0.2f, 0.4f,
      0.3f, 0.5f,
      0.7f, 0.5f
   };

   // The background will just cleared with black color.
   vgSetfv(VG_CLEAR_COLOR, 4, clearColor);

   // Create a paint object.
   paint = vgCreatePaint();
   // Plain color.
   vgSetParameteri(paint, VG_PAINT_TYPE, VG_PAINT_TYPE_COLOR);

   vgSetColor(paint, fillColor);

   // Filled.
   vgSetPaint(paint, VG_FILL_PATH);

   // Create path object for a triangle. See OpenVG 1.1 Specification p80ff
   path = vgCreatePath(VG_PATH_FORMAT_STANDARD, VG_PATH_DATATYPE_F, 1.0f, 0.0f, 4, 3, VG_PATH_CAPABILITY_ALL);
   // Append the path data.
   vgAppendPathData(path, 4, pathSegments, points);

   // Finalize the path, as no more data will be added.
   vgRemovePathCapabilities(path, VG_PATH_CAPABILITY_APPEND_TO);

   VGfloat x,y,tangentX, tangentY;
   vgPointAlongPath(path, 0, 3, 0.4f, &x, &y, &tangentX, &tangentY);
   printf("pointAlongPath = %f, %f, %f, %f\n", x , y, tangentX, tangentY);
}

void
display(float interval)
{
   // Now, the background is painted black.
   vgClear(0, 0, testWidth(), testHeight());

   // Scale to the dimension of the window. Triangle will be stretched when window is resized.
   vgLoadIdentity();
   vgScale((VGfloat)testWidth() , (VGfloat)testHeight());

   // Draw
   vgSetParameteri(paint, VG_PAINT_TYPE, VG_PAINT_TYPE_COLOR);
   vgSetColor(paint, fillColor);
   vgSetPaint(paint, VG_FILL_PATH);

   vgDrawPath(path, VG_FILL_PATH);


}

const char commandsTxt[] =
   "Commands\n"
   "H - this help\n"
   "r - red\n"
   "g - green\n"
   "b - blue \n";


const char help[] = "Press H for a list of commands";
void key(unsigned char code, int x, int y)
{
   static int open = 0;
   switch (tolower(code)) {
   case 'r':
      fillColor = 0xFF0000FF; // red
      break;
   case 'g':
      fillColor = 0x00FF00FF; // green
      break;
   case 'b':
      fillColor = 0x0000FFFF; // blue
      break;
   case 'h':
      /* Show help */
      if (!open) {
         testOverlayString(commandsTxt);
         open = 1;
      } else {
         testOverlayString(help);
         open = 0;
      }
      break;
   }

}


int main(int argc, char *argv[])
{
   testInit(argc, argv, 500, 500, "ShivaVG: Path Primitives Test");
   testCallback(TEST_CALLBACK_DISPLAY, (CallbackFunc) display);
   testCallback(TEST_CALLBACK_KEY, (CallbackFunc) key);
   loadPath();
   testRun();

   return EXIT_SUCCESS;
}
